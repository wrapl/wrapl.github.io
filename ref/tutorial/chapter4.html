<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8"/>
	
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<meta name="description" content=""/>
	<meta name="author" content="ink, cookbook, recipes"/>
	<meta name="HandheldFriendly" content="True"/>
	<meta name="MobileOptimized" content="320"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
	<meta property="og:title" content="Wrapl, The Programming Language"/>
	<meta property="og:description" content="Wrapl, The Programming Language"/>
	<meta property="og:url" content="http://wrapl.sf.net"/>
	<meta property="og:image" content="http://wrapl.sf.net/sample.png"/>


	<link rel="stylesheet" type="text/css" href="/code.css"/>
	<link rel="stylesheet" type="text/css" href="/css/spectre.min.css">
	<link rel="stylesheet" type="text/css" href="/css/spectre-exp.min.css">
	<link rel="stylesheet" type="text/css" href="/css/spectre-icons.min.css">

	<!-- load inks css from the cdn -->
	<!--link rel="stylesheet" type="text/css" href="/css/ink-flex.min.css"/-->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet"> 
	<link rel="stylesheet" href="https://cdn.rawgit.com/tonsky/FiraCode/1.205/distr/fira_code.css">
	<!-- load inks css for IE8 -->
	<!--[if lt IE 9 ]>
		<!--link rel="stylesheet" href="/css/ink-ie.min.css" type="text/css" media="screen" title="no title" charset="utf-8"/-->
	<![endif]-->

	<!-- test browser flexbox support and load legacy grid if unsupported -->
	<script type="text/javascript" src="/js/modernizr.js"></script>
	<script type="text/javascript">
		Modernizr.load({
			test: Modernizr.flexbox,
			nope: "/css/ink-legacy.min.css"
		});
	</script>

	<!-- load inks javascript files from the cdn -->
	<!--script type="text/javascript" src="/js/holder.js"></script-->
	<!--script type="text/javascript" src="/js/ink-all.min.js"></script-->
	<!--script type="text/javascript" src="/js/autoload.min.js"></script-->

	<title>Chapter 4</title>
</head>
<body>

<div class="off-canvas off-canvas-sidebar-show">
	<a class="off-canvas-toggle btn btn-primary btn-action" href="#sidebar-id">
		<i class="icon icon-menu"></i>
	</a>
	<div id="sidebar-id" class="off-canvas-sidebar">
		<ul class="nav">
			<li class="nav-item"><a href="/index.html" class="toplevel"><i class="fa fa-home"></i> Home</a>
				<ul class="nav">
					<li class="nav-item"><a href="/index.html#Features">Features</a></li>
					<li class="nav-item"><a href="/index.html#Contact">Contact</a></li>
				</ul>
			</li>
			<li class="nav-item"><a href="/news.html" class="toplevel"><i class="fa fa-clock"></i> News</a></li>
			<li class="nav-item"><a href="/docs.html" class="toplevel"><i class="fa fa-book"></i> Documentation</a>
				<ul class="nav">
					<li class="nav-item"><a href="/ref/tutorial.html">Tutorial</a></li>
					<li class="nav-item"><a href="/docs.html#Reference">Reference</a>
						<ul class="nav flyout right">
							<li class="nav-item"><a href="/ref/syntax.html">Syntax</a></li>
							<li class="nav-item"><a href="/ref/expressions.html">Expressions</a></li>
						</ul>
					</li>
					<li class="nav-item"><a href="/samples.html">Sample</a></li>
					<li class="nav-item"><a href="/lib.html">Libraries</a></li>
				</ul>
			</li>
			<li class="nav-item"><a href="/download.html" class="toplevel"><i class="fa fa-download"></i> Download</a>
				<ul class="nav">
					<li class="nav-item"><a href="/download.html#Source">Source</a></li>
					<li class="nav-item"><a href="/download.html#Binaries">Binaries</a></li>
				</ul>
			</li>
			<li class="nav-item"><a href="/links.html" class="toplevel"><i class="fa fa-globe"></i> Links</a>
				<ul class="nav">
					<li class="nav-item"><a href="/links.html#Programming_Languages">Other Languages</a></li>
					<li class="nav-item"><a href="/links.html#Development_Tools">Development Tools</a></li>
					<li class="nav-item"><a href="/links.html#Libraries">Libraries</a></li>
				</ul>
			</li>
			<!--li class="nav-item"><a href="/discuss.html" class="toplevel"><i class="fa fa-comments"></i> Discuss</a>
				<ul class="nav">
					<li><a href="http://lists.sourceforge.net/lists/listinfo/wrapl-discussion">Mailing List</a></li>
					<li><a href="/forum/index.php">Forum</a></li>
				</ul>
			</li-->
			<!--li id="forms" class="search small" style="float: right; margin-top: 5px;">
				<form method="get" action="/sphider/search.php" class="ink-form">
					<input type="hidden" name="search" value="1"/>
					<input type="text" name="query" id="do_search">
					<button class="ink-button blue"><i class="fa fa-search"></i> Search</button>
				</form>
			</li-->
		</ul>
	</div>
	<a class="off-canvas-overlay" href="#close"></a>
	<div class="off-canvas-content">
		<h1 id="title"><img src="/logo.png" alt="W"/> Wrapl, The Programming Language</h1>
<section id="Chapter_4" data-spy="true" data-target="#side-menu"><nav class="ink-navigation"><h2><ul class="breadcrumb"><li class="breadcrumb-item previous"><a href="chapter3.html">Previous</a></li><li class="breadcrumb-item"><a href="../tutorial.html">Up</a></li><li class="breadcrumb-item"><a>Chapter 4</a></li>  <li class="breadcrumb-item next"><a href="chapter5.html">Next</a></li></ul></h2></nav>

<section id="Constants" data-spy="true" data-target="#side-menu"><h3>Constants</h3>
<p>In addition to variables, Wrapl also allows the declaration of constants. A constant declaration is similar to a variable declaration, <span class="code"><span class="keyword">DEF</span> <span class="var">id</span> <span class="delimiter">&lt;-</span> <span class="var">value</span></span>, however the initial value is required. Constants are replaced by their value when evaluated, attempting to assign to a constant results in an error. Since constant declarations do not perform any assignment themselves, evaluating them displays <a class="id" href="/doc/Std/Object.html#Nil">NIL</a> in the interactive interpreter.</p>
<div class="term"><span class="prompt">--&gt;</span> DEF x &lt;- 100;
NIL
<span class="prompt">--&gt;</span> x + 20;
120
<span class="prompt">--&gt;</span> x &lt;- 30;
Unhandled message: Assignment to location 0
<span class="prompt">--&gt;</span> x;
100
</div>
</section>

<section id="Functions" data-spy="true" data-target="#side-menu"><h3>Functions</h3>
<p>Functions in Wrapl are written as follows: <span class="code"><span class="delimiter">&lt;</span><span class="var">parameters</span><span class="delimiter">&gt;</span> <span class="var">expression</span></span>. When a function is called, the parameters are assigned values and the expression is evaluated. The value of the expression is returned as the result of the function. If too many arguments are supplied to a function, the extra arguments are evaluated, but discarded. If too few arguments are supplied, the missing parameters are set to <a class="id" href="/doc/Std/Object.html#Nil">NIL</a>.</p>
<p>For example:</p>
<div class="term"><span class="prompt">--&gt;</span> VAR f &lt;- &lt;x, y&gt; x + y;
&lt;value&gt;
<span class="prompt">--&gt;</span> f(10, 20, "discarded");
30
</div>

<p>Since functions are used commonly, Wrapl provides syntactical sugar for assigning functions. Normally, functions are assigned to constants. Within the standard Wrapl libraries, function names begin with capital letters.</p>
<div class="term"><span class="prompt">--&gt;</span> VAR F(x, y) x + y;
&lt;value&gt;
<span class="prompt">--&gt;</span> F(10, 20);
30
<span class="prompt">--&gt;</span> DEF G(x, y, z) [x, y, z];
NIL
<span class="prompt">--&gt;</span> G(10, 5);
[10, 5, NIL]
<span class="prompt">--&gt;</span> DEF Fact(n) n &lt; 2 =&gt; 1 // n * Fact(n - 1);
NIL
<span class="prompt">--&gt;</span> Fact(10);
3628800
</div>

</section>

<section id="Blocks" data-spy="true" data-target="#side-menu"><h3>Blocks</h3>
<p>Even though a function can only contain a single expression, this is not a restriction since the expression can be a block. Blocks in Wrapl are written in parentheses <span class="code"><span class="delimiter">(</span></span> ... <span class="code"><span class="delimiter">)</span></span> and may contain any number (including zero) of expressions or declarations. Each declaration and each expression except the last one must be terminated by a semicolon. A semicolon is not required after the last expression, but it is allowed. A block produces the values of its last expression. For example:</p>
<div class="term"><span class="prompt">--&gt;</span> DEF Dist(x1, y1, x2, y2) (
<span class="prompt">...</span>     VAR dx &lt;- x2 - x1;
<span class="prompt">...</span>     VAR dy &lt;- y2 - y1;
<span class="prompt">...</span>     :sqrt(dy ^ 2 + dx ^ 2);
<span class="prompt">...</span> );
NIL
<span class="prompt">--&gt;</span> Dist(0.0, 1.0, 1.0, 0.0);
1.4142135623730951455
</div>

<p>Blocks can be used anywhere an expression is expected. An empty block is equivalent to <a class="id" href="/doc/Std/Object.html#Nil">NIL</a>. Blocks with only one expression can be used to control operator precedence.</p>
<div class="term"><span class="prompt">--&gt;</span> ();
NIL
<span class="prompt">--&gt;</span> 2 * (3 + 4);
14
</div>

<p>Variables declared within a block are visible for the entire scope of the block, including before the declaration itself. However, variables are initialized only at the declaration itself, and will have the value <a class="id" href="/doc/Std/Object.html#Nil">NIL</a> before it. Note that this does not apply to top level declarations in the interactive interpreter, since it uses an incremental scope.</p>
<div class="term"><span class="prompt">--&gt;</span> IMP IO.Terminal USE Out;
NIL
<span class="prompt">--&gt;</span> DEF Test() (
<span class="prompt">...</span>     Out:write('x = {x}\n');
<span class="prompt">...</span>     VAR x &lt;- 100;
<span class="prompt">...</span>     Out:write('x = {x}\n');
<span class="prompt">...</span>     NIL;
<span class="prompt">...</span> );
NIL
<span class="prompt">--&gt;</span> Test();
x = NIL
x = 100
NIL
<span class="prompt">--&gt;</span> x;
console(6): Error: identifier x not declared
<span class="prompt">--&gt;</span> VAR x &lt;- 100;
100
<span class="prompt">--&gt;</span> x;
100
</div>

</section>

<section id="Returning_from_Functions" data-spy="true" data-target="#side-menu"><h3>Returning from Functions</h3>
<p>A function <span class="code"><span class="delimiter">&lt;</span><span class="var">params</span><span class="delimiter">&gt;</span> <span class="var">body</span></span> normally returns only the first value produced by <span class="var">body</span>, or fails if <span class="var">body</span> fails to produce any values.</p>
<div class="term"><span class="prompt">--&gt;</span> ALL 1:to(4);
[1, 2, 3, 4]
<span class="prompt">--&gt;</span> DEF F() 1:to(4);
NIL
<span class="prompt">--&gt;</span> ALL F();
[1]
</div>

<p>However, it is possible to return from any point within a function, using the expression <span class="code"><span class="keyword">RET</span> <span class="var">value</span></span>. This causes the current function to terminate, returning the first value produced by <span class="var">value</span>. If <span class="var">value</span> fails, then the function still terminates, but fails to produce any value. If <span class="var">value</span> is omitted, <a class="id" href="/doc/Std/Object.html#Nil">NIL</a> is used. The expression <span class="code"><span class="keyword">FAIL</span></span> is equivalent to <span class="code"><span class="keyword">RET</span> <span class="keyword">BACK</span></span>, i.e. it terminates the current function, failing to produce any value.</p>
<div class="term"><span class="prompt">--&gt;</span> DEF F() (
<span class="prompt">...</span>     VAR x &lt;- 100;
<span class="prompt">...</span>     RET x;
<span class="prompt">...</span>     x &lt;- 200; -- This line is never reached
<span class="prompt">...</span> );
NIL
<span class="prompt">--&gt;</span> F();
200
<span class="prompt">--&gt;</span> DEF IsNonZero(x) (
<span class="prompt">...</span>     x ~= 0 =&gt; RET x;
<span class="prompt">...</span>     FAIL;
<span class="prompt">...</span> );
NIL
<span class="prompt">--&gt;</span> IsNonZero(1);
1
<span class="prompt">--&gt;</span> IsNonZero(0);
failure
</div>

<p>Perhaps the most powerful way to return from a function is to suspend a value using <span class="code"><span class="keyword">SUSP</span> <span class="var">value</span></span>. This doesn't terminate the current function, instead it stores its state, and returns execution to the calling code, with the first value produced by <span class="var">value</span>. Then, if the function call is resumed (because some later expression in the calling code fails), the suspended function resumes after the <span class="code"><span class="keyword">SUSP</span></span> expression, allowing it to suspend another value (or return or fail). This allows generators to be written in Wrapl.</p>
<div class="term"><span class="prompt">--&gt;</span> DEF S() (
<span class="prompt">...</span>     SUSP 1;
<span class="prompt">...</span>     SUSP 2;
<span class="prompt">...</span>     SUSP 3;
<span class="prompt">...</span>     RET 4;
<span class="prompt">...</span>     SUSP 5; -- This line is never reached
<span class="prompt">...</span> );
NIL
<span class="prompt">--&gt;</span> ALL S();
[1, 2, 3, 4]
</div>

<p><span class="code"><span class="keyword">SUSP</span> <span class="var">value</span></span> only suspends the first value produced by <span class="var">value</span>, unless a later expression causes it to backtrack. However, unlike <span class="code"><span class="keyword">RET</span> <span class="var">value</span></span>, if <span class="var">value</span> fails, the entire <span class="code"><span class="keyword">SUSP</span></span> expression fails, and the current function continues executing.</p>
<div class="term"><span class="prompt">--&gt;</span> DEF T() (
<span class="prompt">...</span>     SUSP 1 | 2 | 3; -- Only 1 is suspended
<span class="prompt">...</span>     (SUSP 10 | 11 | 12) &amp; BACK; -- This will suspend all three values
<span class="prompt">...</span>     SUSP BACK; -- This does nothing
<span class="prompt">...</span>     SUSP 20;
<span class="prompt">...</span> );
NIL
<span class="prompt">--&gt;</span> ALL T();
[1, 10, 11, 12, 20, 20]
</div>
<p>The extra <span class="code">20</span> in the last function demonstrates a potential pitfall when using the <span class="code"><span class="keyword">SUSP</span></span> expression. When the suspended function is resumed, the <span class="code"><span class="keyword">SUSP</span> <span class="var">value</span></span> expression produces the last value produced by <span class="code"><span class="var">value</span></span>. Thus, if used at the end of a function, the same value will be generated twice, once by the <span class="code"><span class="keyword">SUSP</span></span> expression, and then returned as the value of the last expression in the block. In general <span class="code"><span class="keyword">SUSP</span></span> should not be used as the last expression of a function, use <span class="code"><span class="keyword">RET</span></span> instead, or add an explicit <span class="code"><span class="keyword">FAIL</span></span> after.</p>

</section>

</section>
	<div>
		<span class="left"></span>
		<span>Copyright: &copy; 2008-2018 Raja Mukherji</span>
	</div>
</div>
</body>
</html>
